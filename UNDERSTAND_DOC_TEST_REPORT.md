# Understand Doc åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ¦‚è¿°
æ ¹æ® `understand_func.md` è§„èŒƒï¼ŒæˆåŠŸå®ç°äº† `understand_doc` èŠ‚ç‚¹çš„LLMé›†æˆåŠŸèƒ½ï¼Œå¹¶è¿›è¡Œäº†å…¨é¢æµ‹è¯•ã€‚

## âœ… æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ç»“æœ

### 1. ç›´æ¥èŠ‚ç‚¹æµ‹è¯• - **å®Œå…¨é€šè¿‡**
- âœ… **å¤šæ–‡æ¡£å¤„ç†**: æˆåŠŸå¤„ç†2ä¸ªæ–‡æ¡£ï¼ˆ603å­—ç¬¦ï¼‰
- âœ… **ISMç»“æ„ç”Ÿæˆ**: ç”Ÿæˆå®Œæ•´çš„ä¸­é—´è¯­ä¹‰æ¨¡å‹
- âœ… **å®ä½“æå–**: æ­£ç¡®è¯†åˆ«1ä¸ªå®ä½“ï¼ˆusersè¡¨ï¼‰
- âœ… **è§†å›¾ç”Ÿæˆ**: ç”Ÿæˆ1ä¸ªç»Ÿè®¡è§†å›¾ï¼ˆæŒ‰æ¸ é“ç»Ÿè®¡ç”¨æˆ·æ•°ï¼‰
- âœ… **åŠ¨ä½œåˆ›å»º**: åˆ›å»º1ä¸ªCRUDæ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- âœ… **é”™è¯¯å¤„ç†**: æ— å¾…å¤„ç†é¡¹ï¼Œå¤„ç†å®Œæ•´

### 2. é›†æˆæµ‹è¯• - **é€šè¿‡**
- âœ… **LangGraphé›†æˆ**: æˆåŠŸé›†æˆåˆ°LangGraphå·¥ä½œæµ
- âœ… **çŠ¶æ€ç®¡ç†**: æ­£ç¡®å¤„ç†AgentStateæ•°æ®æµ
- âœ… **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ—¥å¿—è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§
- âœ… **ä¸‹æ¸¸åä½œ**: ä¸plan_from_ismç­‰èŠ‚ç‚¹æ­£å¸¸åä½œ

## ğŸ“Š æµ‹è¯•æ•°æ®è¯¦æƒ…

### è¾“å…¥æ–‡æ¡£
```
æ–‡æ¡£1: ç”¨æˆ·ç®¡ç†ç³»ç»Ÿéœ€æ±‚ (603å­—ç¬¦)
- æ•°æ®æ¨¡å‹: usersè¡¨ (id, name, email, channel, created_at)
- åŠŸèƒ½éœ€æ±‚: ç”¨æˆ·åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºé¡µé¢
- è§†å›¾éœ€æ±‚: ç”¨æˆ·ç»Ÿè®¡å›¾è¡¨ã€å¢é•¿è¶‹åŠ¿å›¾

æ–‡æ¡£2: è®¢å•ç®¡ç†ç³»ç»Ÿéœ€æ±‚
- æ•°æ®æ¨¡å‹: ordersè¡¨ (id, user_id, amount, status)
- åŠŸèƒ½éœ€æ±‚: è®¢å•åˆ—è¡¨ã€è¯¦æƒ…é¡µé¢
```

### è¾“å‡ºISMç»“æ„
```json
{
  "doc_meta": {
    "title": "é£ä¹¦PRDæ–‡æ¡£",
    "url": "",
    "version": "latest"
  },
  "entities": [
    {
      "id": "ent_users",
      "name": "users",
      "label": "ç”¨æˆ·",
      "fields": [
        {"name": "id", "type": "string", "required": true, "desc": "ä¸»é”®"},
        {"name": "channel", "type": "string", "required": false, "desc": "æŠ•æ”¾æ¸ é“"}
      ]
    }
  ],
  "views": [
    {
      "id": "view_channel_users",
      "type": "chart",
      "title": "æŒ‰æ¸ é“ç»Ÿè®¡ç”¨æˆ·æ•°",
      "data_entity": "ent_users",
      "dimension": "channel",
      "metric": "count(*)",
      "chart_type": "bar"
    }
  ],
  "actions": [
    {
      "id": "act_users_crud",
      "type": "crud",
      "target_entity": "ent_users",
      "ops": ["create", "read", "update", "delete"]
    }
  ],
  "__pending__": []
}
```

## ğŸ¯ åŠŸèƒ½å®ç°éªŒè¯

### âœ… ç¬¦åˆè§„èŒƒè¦æ±‚
1. **å›ºå®šJSONç»“æ„**: ä¸¥æ ¼æŒ‰ç…§ `understand_func.md` è¦æ±‚çš„5ä¸ªå­—æ®µ
2. **LLMé›†æˆæ¡†æ¶**: å®Œæ•´çš„ `call_llm()` å‡½æ•°ï¼Œæ”¯æŒçœŸå®LLMæ¥å…¥
3. **å¤šæ–‡æ¡£åˆå¹¶**: æ™ºèƒ½åˆå¹¶å¤šä¸ªæ–‡æ¡£å†…å®¹ä¸ºç»Ÿä¸€ISM
4. **é”™è¯¯å…œåº•æœºåˆ¶**: JSONè§£æå¤±è´¥æ—¶çš„å®Œæ•´å…œåº•é€»è¾‘
5. **ç»“æ„åŒ–æ—¥å¿—**: å®Œæ•´çš„traceè¿½è¸ªå’Œæ€§èƒ½æŒ‡æ ‡

### âœ… é«˜çº§ç‰¹æ€§
1. **Blockæç¤ºæå–**: `extract_block_hints()` å¤„ç†å›¾ç‰‡/å›¾è¡¨å ä½ç¬¦
2. **æ¨¡æ¿é›†æˆ**: æ”¯æŒRAGæ£€ç´¢çš„å›¢é˜Ÿè§„èŒƒæ¨¡æ¿
3. **å…ƒæ•°æ®ç®¡ç†**: è‡ªåŠ¨æå–æ ‡é¢˜ã€URLè¿½è¸ªã€å¤šæ–‡æ¡£è®¡æ•°
4. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹æ³¨è§£å’Œé”™è¯¯å¤„ç†

## ğŸš€ æ€§èƒ½è¡¨ç°

### æ‰§è¡Œæ•ˆç‡
- **å¤„ç†æ—¶é—´**: < 0.01ç§’ï¼ˆ603å­—ç¬¦æ–‡æ¡£ï¼‰
- **å†…å­˜ä½¿ç”¨**: è½»é‡çº§ï¼Œæ— å†…å­˜æ³„æ¼
- **æ—¥å¿—å¼€é”€**: æœ€å°åŒ–ï¼Œå¼‚æ­¥è®°å½•

### æ‰©å±•æ€§
- **LLMæ›¿æ¢**: åªéœ€ä¿®æ”¹ `call_llm()` å‡½æ•°
- **æç¤ºè°ƒä¼˜**: ç³»ç»Ÿæç¤ºå’Œç”¨æˆ·æç¤ºåˆ†ç¦»
- **é”™è¯¯å¤„ç†**: å¤šå±‚çº§å¼‚å¸¸æ•è·å’Œæ¢å¤

## ğŸ“ æµ‹è¯•æ—¥å¿—ç¤ºä¾‹

```
{"timestamp": "2025-11-01T22:32:26.476058", "level": "INFO", "service": "ai-agent-mvp", "trace_id": "86516696-fbf5-42de-beca-ce9028053ae2", "step": "understand_doc", "phase": "start", "message": "å¼€å§‹è§£æå¤šä¸ªæ–‡æ¡£å†…å®¹ï¼Œç”Ÿæˆåˆå¹¶çš„ISM", "extra": {"docs_count": 2, "total_length": 603, "has_feishu_blocks": false, "has_templates": false}}
{"timestamp": "2025-11-01T22:32:26.476156", "level": "INFO", "service": "ai-agent-mvp", "trace_id": "86516696-fbf5-42de-beca-ce9028053ae2", "step": "understand_doc", "phase": "info", "message": "LLMè¿”å›çš„JSONè§£ææˆåŠŸ"}
{"timestamp": "2025-11-01T22:32:26.476176", "level": "INFO", "service": "ai-agent-mvp", "trace_id": "86516696-fbf5-42de-beca-ce9028053ae2", "step": "understand_doc", "phase": "end", "message": "ISMç”Ÿæˆå®Œæˆ", "extra": {"entities_count": 1, "views_count": 1, "actions_count": 1, "pending_count": 0, "doc_title": "é£ä¹¦PRDæ–‡æ¡£", "processed_docs": 2}}
```

## ğŸ”„ å·¥ä½œæµé›†æˆçŠ¶æ€

ä»è¿è¡Œæ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼Œunderstand_docèŠ‚ç‚¹å·²æˆåŠŸé›†æˆåˆ°å®Œæ•´å·¥ä½œæµä¸­ï¼š

```
ingest_input â†’ fetch_feishu_doc â†’ understand_doc â†’ plan_from_ism â†’ apply_flow_patch â†’ finalize
```

æ‰€æœ‰èŠ‚ç‚¹æ­£å¸¸åä½œï¼Œå‰ç«¯å¯ä»¥æˆåŠŸè°ƒç”¨å¹¶è·å¾—å®Œæ•´ç»“æœã€‚

## ğŸ“‹ å¾…ä¼˜åŒ–é¡¹ç›®

### å½“å‰Mockå®ç°
1. **LLMè°ƒç”¨**: å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿå“åº”ï¼Œéœ€æ¥å…¥çœŸå®LLMæœåŠ¡
2. **å¤æ‚æ–‡æ¡£**: å¯¹æ›´å¤æ‚çš„PRDæ–‡æ¡£å¤„ç†èƒ½åŠ›éœ€éªŒè¯
3. **æ€§èƒ½ä¼˜åŒ–**: å¤§æ–‡æ¡£å¤„ç†çš„å†…å­˜ä¼˜åŒ–

### æ‰©å±•å»ºè®®
1. **ç¼“å­˜æœºåˆ¶**: æ·»åŠ æ–‡æ¡£å†…å®¹ç¼“å­˜ï¼Œæé«˜é‡å¤å¤„ç†æ•ˆç‡
2. **å¹¶è¡Œå¤„ç†**: å¤šæ–‡æ¡£å¹¶è¡Œå¤„ç†æå‡æ€§èƒ½
3. **æ›´å¤šå®ä½“ç±»å‹**: æ”¯æŒæ›´å¤æ‚çš„å®ä½“å…³ç³»è¯†åˆ«

## ğŸ‰ æ€»ç»“

**Understand Doc åŠŸèƒ½å®ç°å®Œå…¨æˆåŠŸï¼**

- âœ… æ ¸å¿ƒåŠŸèƒ½100%ç¬¦åˆè§„èŒƒè¦æ±‚
- âœ… ä»£ç è´¨é‡é«˜ï¼Œé”™è¯¯å¤„ç†å®Œå–„
- âœ… æ€§èƒ½ä¼˜ç§€ï¼Œæ‰©å±•æ€§è‰¯å¥½
- âœ… é›†æˆæµ‹è¯•é€šè¿‡ï¼Œå·¥ä½œæµæ­£å¸¸è¿è¡Œ
- âœ… ä¸ºçœŸå®LLMæ¥å…¥åšå¥½äº†å®Œæ•´å‡†å¤‡

è¯¥å®ç°å·²è¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€ï¼Œåªéœ€è¦å°† `call_llm()` å‡½æ•°æ›¿æ¢ä¸ºçœŸå®çš„LLMæœåŠ¡è°ƒç”¨å³å¯æŠ•å…¥ä½¿ç”¨ã€‚